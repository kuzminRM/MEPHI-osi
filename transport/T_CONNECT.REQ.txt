;параметры:  address (число)
out CurrentSystemName() " t con req __start"
0 setto currentReqNumMy
0 setto currentReqNumTheir
1 setto entityNum
userDataNoCrc pack $currentReqNumMy 1 $entityNum 1 2
varcrc crcCalculated $userDataNoCrc
transportUserData pack $crcCalculated 1 $userDataNoCrc sizeof(userDataNoCrc) sizeof(userDataNoCrc)+1
$address setto connectedAddr

; если сейчас работает таймер, то кладем новые данные в очередь, иначе сразу отправляем
$delayTimer != 0 if queue_new_data_tag

; оправляем несколько пакетов подряд в цикле
0 setto i ;
while_tag:
$i + 1 setto i

address $connectedAddr userdata $transportUserData eventdown N_DATAGRAM.REQ
out "send n data req with " $currentReqNumMy " | " $i " of " $SEND_DATA_N_TIMES

$i < $SEND_DATA_N_TIMES if while_tag

timeevent T_DELAY_TIMER delayTimer $DELAY_TIME
goto finally_tag
return

queue_new_data_tag:
queue $transportUserData  sendQueue
goto finally_tag
return

finally_tag:
; увеличиваем currentReqNumMy
$currentReqNumMy + 1 setto currentReqNumMy
return
